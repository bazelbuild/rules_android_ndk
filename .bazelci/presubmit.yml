---
buildifier: latest

common: &common
  build_flags:
    - "--incompatible_disallow_empty_glob"
    - "--incompatible_enable_android_toolchain_resolution"

basic_example: &basic_example
  working_directory: examples/basic
  build_flags:
    - "--android_platforms=//:arm64-v8a,//:x86"
    - "--enable_bzlmod=False"
  build_targets:
    - "//java/com/app:app"
  <<: *common

basic_example_bzlmod: &basic_example_bzlmod
  working_directory: examples/basic
  build_flags:
    - "--android_platforms=//:arm64-v8a,//:x86"
    - "--enable_bzlmod=True"
  build_targets:
    - "//java/com/app:app"
  <<: *common

cpu_features: &cpu_features
  working_directory: examples/cpu_features
  build_flags:
    - "--platforms=//:arm64-v8a"
  build_targets:
    - "//:all"
  <<: *common

ubuntu2004: &ubuntu2004
  platform: ubuntu2004
  environment:
    ANDROID_NDK_HOME: /opt/android-ndk-r25b

macos: &macos
  platform: macos
  environment:
    ANDROID_NDK_HOME: /Users/buildkite/android-ndk-r25b

tasks:
  basic_example_ubuntu2004:
    name: ubuntu2004 Basic Example
    <<: [*ubuntu2004, *basic_example]
  basic_example_bzlmod_ubuntu2004:
    name: ubuntu2004 Basic Example Bzlmod
    <<: [*ubuntu2004, *basic_example_bzlmod]
  basic_example_macos:
    name: macos Basic Example
    <<: [*macos, *basic_example]
  basic_example_bzlmod_macos:
    name: macos Basic Example Bzlmod
    <<: [*macos, *basic_example_bzlmod]

  cpu_features_ubuntu2004:
    name: ubuntu2004 CPU Features
    <<: [*ubuntu2004, *cpu_features]
  cpu_features_macos:
    name: macos CPU Features
    <<: [*macos, *cpu_features]
