---
buildifier: latest
matrix:
  platform: ["ubuntu2004", "macos"]

tasks:
  basic_example:
    working_directory: examples/basic
    platform: ${{ platform }}
    shell_commands:
      - [ $(uname) == "Linux" ] && export ANDROID_NDK_HOME=/opt/android-ndk-r25b || export ANDROID_NDK_HOME=/Users/buildkite/android-ndk-r25b
    build_flags:
      - "--noincompatible_enable_cc_toolchain_resolution"
      - "--fat_apk_cpu=arm64-v8a,x86"
      - "--android_crosstool_top=@androidndk//:toolchain"
    build_targets:
      - "//java/com/app:app"
  cpu_features:
    working_directory: examples/cpu_features
    platform: ${{ platform }}
    shell_commands:
      - [ $(uname) == "Linux" ] && export ANDROID_NDK_HOME=/opt/android-ndk-r25b || export ANDROID_NDK_HOME=/Users/buildkite/android-ndk-r25b
    build_flags:
      - "--noincompatible_enable_cc_toolchain_resolution"
      - "--cpu=arm64-v8a"
      - "--crosstool_top=@androidndk//:toolchain"
    build_targets:
      - "//:all"
